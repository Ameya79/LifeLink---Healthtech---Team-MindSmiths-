{% extends "base.html" %}

{% block title %}My Patients - LifeLink{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header d-flex justify-between align-center">
        <h1>
            <i class="fas fa-user-injured"></i>
            My Patients
        </h1>
        <a href="{{ url_for('add_patient') }}" class="btn btn-danger">
            <i class="fas fa-plus-circle"></i>
            Add New Patient
        </a>
    </div>

    <!-- Filters -->
    <div class="filters">
        <div class="filters-grid">
            <div>
                <label class="form-label">Blood Group</label>
                <select id="blood-filter" class="form-select" data-table="patients-table">
                    <option value="all">All Blood Groups</option>
                    <option value="A+">A+</option>
                    <option value="A-">A-</option>
                    <option value="B+">B+</option>
                    <option value="B-">B-</option>
                    <option value="AB+">AB+</option>
                    <option value="AB-">AB-</option>
                    <option value="O+">O+</option>
                    <option value="O-">O-</option>
                </select>
            </div>
            <div>
                <label class="form-label">Organ Needed</label>
                <select id="organ-filter" class="form-select" data-table="patients-table">
                    <option value="all">All Organs</option>
                    <option value="Kidney">Kidney</option>
                    <option value="Liver">Liver</option>
                    <option value="Heart">Heart</option>
                    <option value="Lung">Lung</option>
                    <option value="Pancreas">Pancreas</option>
                </select>
            </div>
            <div>
                <label class="form-label">Search</label>
                <input type="text" id="table-search" class="form-control" placeholder="Search by name or ID..." data-table="patients-table">
            </div>
        </div>
    </div>

    <!-- Patients Table -->
    <div class="card">
        <div class="card-header">
            <h3 style="margin: 0;">All Patients ({{ patients|length }})</h3>
        </div>
        <div class="table-responsive">
            {% if patients %}
            <table class="table" id="patients-table">
                <thead>
                    <tr>
                        <th>Patient ID</th>
                        <th>Name</th>
                        <th>Blood</th>
                        <th>Organ Needed</th>
                        <th>Urgency</th>
                        <th>Location</th>
                        <th>Doctor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for patient in patients %}
                    <tr data-id="{{ patient.patient_id }}" data-type="patient" data-blood="{{ patient.blood_group }}" data-organ="{{ patient.organ_needed }}" data-location="{{ patient.location }}">
                        <td><strong>{{ patient.patient_id }}</strong></td>
                        <td>{{ patient.name }}</td>
                        <td><span class="badge badge-danger">{{ patient.blood_group }}</span></td>
                        <td><i class="fas fa-heartbeat"></i> {{ patient.organ_needed }}</td>
                        <td>
                            {% if patient.urgency_score >= 80 %}
                            <span class="badge urgency-critical">{{ patient.urgency_score }}%</span>
                            {% elif patient.urgency_score >= 50 %}
                            <span class="badge urgency-high">{{ patient.urgency_score }}%</span>
                            {% else %}
                            <span class="badge urgency-medium">{{ patient.urgency_score }}%</span>
                            {% endif %}
                        </td>
                        <td><i class="fas fa-map-marker-alt"></i> {{ patient.location }}</td>
                        <td style="color: var(--text-secondary);">{{ patient.doctor_assigned }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div style="text-align: center; padding: 4rem;">
                <i class="fas fa-inbox" style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
                <p style="color: var(--text-secondary);">No patients registered yet</p>
                <a href="{{ url_for('add_patient') }}" class="btn btn-danger mt-2">
                    <i class="fas fa-plus-circle"></i>
                    Add First Patient
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}