{% extends "base.html" %}

{% block title %}Add Patient - LifeLink{% endblock %}

{% block content %}
<div class="container" style="max-width: 900px;">
    <div class="page-header">
        <h1>
            <i class="fas fa-user-plus"></i>
            Register New Patient
        </h1>
    </div>

    <div class="card">
        <div class="card-body" style="padding: 32px;">
            <form method="POST" data-validate>
                <!-- Basic Information -->
                <h3 style="color: var(--text-primary); margin-bottom: 20px; font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-id-card" style="color: var(--primary);"></i> Basic Information
                </h3>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date of Birth *</label>
                        <input type="date" class="form-control" name="dob" max="{{ today }}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gender *</label>
                        <select class="form-select" name="gender" required>
                            <option value="">Select</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Blood Group *</label>
                        <select class="form-select" name="blood_group" required>
                            <option value="">Select</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contact Number *</label>
                        <input type="tel" class="form-control" name="contact" pattern="[0-9]{10}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Location *</label>
                        <input type="text" class="form-control" name="location" placeholder="City" required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Weight (kg) *</label>
                        <input type="number" class="form-control" name="weight_kg" id="weight_kg" step="0.1" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Height (cm) *</label>
                        <input type="number" class="form-control" name="height_cm" id="height_cm" step="0.1" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">BMI (auto)</label>
                        <input type="text" class="form-control" id="bmi-display" readonly value="--">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Doctor Assigned *</label>
                    <input type="text" class="form-control" name="doctor_assigned" placeholder="Dr. Name" required>
                </div>

                <!-- Organ & Medical Info -->
                <hr style="margin: 2rem 0; border-color: var(--border-color);">
                <h3 style="color: var(--text-primary); margin-bottom: 20px; font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-heartbeat" style="color: var(--primary);"></i> Medical Information
                </h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Organ Needed *</label>
                        <select class="form-select" name="organ_needed" id="organ_needed" required>
                            <option value="">Select Organ</option>
                            <option value="Kidney">Kidney</option>
                            <option value="Liver">Liver</option>
                            <option value="Heart">Heart</option>
                            <option value="Lung">Lung</option>
                            <option value="Pancreas">Pancreas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Urgency Score (1-100) *</label>
                        <input type="range" class="form-control" name="urgency_score" id="urgency_score" min="1" max="100" value="50" required>
                        <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                            <span id="urgency-value" style="font-weight: 700; font-size: 1.25rem;">50</span>
                            <span id="urgency-label" style="font-weight: 600;">Moderate</span>
                        </div>
                    </div>
                </div>

                <!-- Kidney-Specific Fields -->
                <div id="kidney-fields" class="organ-specific" style="display: none;">
                    <h4 style="color: var(--text-secondary); margin: 1.5rem 0 1rem;">Kidney-Specific Metrics</h4>
                    <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.75rem; margin-bottom: 1rem;">
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-A1</label>
                            <input type="text" class="form-control" name="hla_a1" placeholder="A1">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-A2</label>
                            <input type="text" class="form-control" name="hla_a2" placeholder="A2">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-B1</label>
                            <input type="text" class="form-control" name="hla_b1" placeholder="B7">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-B2</label>
                            <input type="text" class="form-control" name="hla_b2" placeholder="B8">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-DR1</label>
                            <input type="text" class="form-control" name="hla_dr1" placeholder="DR1">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-DR2</label>
                            <input type="text" class="form-control" name="hla_dr2" placeholder="DR4">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Dialysis Status</label>
                            <select class="form-select" name="dialysis_status">
                                <option value="None">None</option>
                                <option value="Hemodialysis">Hemodialysis</option>
                                <option value="Peritoneal">Peritoneal Dialysis</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dialysis Duration (months)</label>
                            <input type="number" class="form-control" name="dialysis_duration_months" value="0">
                        </div>
                    </div>
                </div>

                <!-- Liver-Specific Fields -->
                <div id="liver-fields" class="organ-specific" style="display: none;">
                    <h4 style="color: var(--text-secondary); margin: 1.5rem 0 1rem;">Liver-Specific Metrics</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">MELD Score</label>
                            <input type="number" class="form-control" name="meld_score" min="6" max="40" placeholder="6-40">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Diagnosis</label>
                            <input type="text" class="form-control" name="diagnosis" placeholder="e.g., Cirrhosis">
                        </div>
                    </div>
                </div>

                <!-- Heart-Specific Fields -->
                <div id="heart-fields" class="organ-specific" style="display: none;">
                    <h4 style="color: var(--text-secondary); margin: 1.5rem 0 1rem;">Heart-Specific Metrics</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Ejection Fraction (%)</label>
                            <input type="number" class="form-control" name="ejection_fraction" min="0" max="100" placeholder="15-50">
                        </div>
                        <div class="form-group">
                            <label class="form-label">UNOS Status</label>
                            <select class="form-select" name="unos_status">
                                <option value="1A">1A (Critical)</option>
                                <option value="1B">1B (High Priority)</option>
                                <option value="2">2 (Medium)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Pancreas-Specific Fields -->
                <div id="pancreas-fields" class="organ-specific" style="display: none;">
                    <h4 style="color: var(--text-secondary); margin: 1.5rem 0 1rem;">Pancreas-Specific Metrics</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Diabetes Type</label>
                            <select class="form-select" name="diabetes_type">
                                <option value="Type 1">Type 1 Diabetes</option>
                                <option value="Type 2">Type 2 Diabetes</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Insulin Dependency (years)</label>
                            <input type="number" class="form-control" name="insulin_dependency_years" min="0" placeholder="Years">
                        </div>
                        <div class="form-group">
                            <label class="form-label">HbA1c Level (%)</label>
                            <input type="number" class="form-control" name="hba1c_level" step="0.1" min="0" max="15" placeholder=">8.0">
                        </div>
                    </div>
                </div>

                <!-- Lung-Specific Fields -->
                <div id="lung-fields" class="organ-specific" style="display: none;">
                    <h4 style="color: var(--text-secondary); margin: 1.5rem 0 1rem;">Lung-Specific Metrics</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Diagnosis</label>
                            <select class="form-select" name="diagnosis">
                                <option value="COPD">COPD</option>
                                <option value="Cystic Fibrosis">Cystic Fibrosis</option>
                                <option value="IPF">Idiopathic Pulmonary Fibrosis (IPF)</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Oxygen Dependency</label>
                            <select class="form-select" name="oxygen_dependency">
                                <option value="None">None</option>
                                <option value="Intermittent">Intermittent</option>
                                <option value="Continuous">Continuous</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">6-Minute Walk Test (meters)</label>
                            <input type="number" class="form-control" name="six_minute_walk_test" min="0" placeholder="Distance">
                        </div>
                    </div>
                </div>

                <!-- Medical History -->
                <div class="form-group">
                    <label class="form-label">Medical History (select all that apply)</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="medical_history" value="Diabetes"> Diabetes
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="medical_history" value="Hypertension"> Hypertension
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="medical_history" value="Heart Disease"> Heart Disease
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="medical_history" value="Kidney Disease"> Kidney Disease
                        </label>
                    </div>
                </div>

                <!-- Submit -->
                <button type="submit" class="btn btn-danger btn-lg btn-block mt-4">
                    <i class="fas fa-check-circle"></i>
                    Register Patient
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}