{% extends "base.html" %}

{% block title %}Settings - LifeLink{% endblock %}

{% block content %}
<div class="container" style="max-width: 900px;">
    <div class="page-header">
        <h1>
            <i class="fas fa-cog"></i>
            Settings
        </h1>
    </div>

    <div class="card">
        <div class="card-header">
            <h3>Account Information</h3>
        </div>
        <div class="card-body">
            <div class="detail-grid">
                <div class="detail-card">
                    <h3>Hospital Details</h3>
                    <div class="detail-row">
                        <span class="detail-label">Hospital Name</span>
                        <span class="detail-value">{{ session.hospital_name }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Location</span>
                        <span class="detail-value">{{ session.location_city }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Hospital ID</span>
                        <span class="detail-value">{{ session.hospital_id }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h3>Display Preferences</h3>
        </div>
        <div class="card-body">
            <div class="form-group">
                <label class="form-label">Theme</label>
                <div style="display: flex; gap: 12px;">
                    <button id="theme-light" class="btn btn-outline" style="flex: 1;">
                        <i class="fas fa-sun"></i> Light
                    </button>
                    <button id="theme-dark" class="btn btn-outline" style="flex: 1;">
                        <i class="fas fa-moon"></i> Dark
                    </button>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Items Per Page</label>
                <select class="form-select" id="items-per-page" data-preference-key="items_per_page">
                    <option value="10">10</option>
                    <option value="25" selected>25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Default Filters</label>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" id="filter-active-only" checked data-preference-key="filter_active_only"> Show only active records
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="filter-my-hospital" data-preference-key="filter_my_hospital"> Show only my hospital records
                    </label>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h3>Notification Preferences</h3>
        </div>
        <div class="card-body">
            <div class="form-group">
                <label class="checkbox-item" style="display: flex; align-items: center; gap: 8px; padding: 0;">
                    <input type="checkbox" id="notify-urgent" data-preference-key="notify_urgent_cases"> Alert for urgent cases (urgency â‰¥ 80)
                </label>
            </div>
            <div class="form-group">
                <label class="checkbox-item" style="display: flex; align-items: center; gap: 8px; padding: 0;">
                    <input type="checkbox" id="notify-new-donors" data-preference-key="notify_new_donors"> Notify when new donors added to network
                </label>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h3>REM Chatbot</h3>
        </div>
        <div class="card-body">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                REM (Resource & Emergency Matching) is powered by Gemini AI and is fully integrated. 
                You can ask REM questions about patients, donors, matches, and statistics using natural language.
            </div>
            <p style="color: var(--text-secondary); margin-bottom: 16px;">
                REM is available via the floating chat button in the bottom-right corner of your screen.
            </p>
            <div style="display: grid; gap: 12px;">
                <div style="padding: 12px; background: var(--bg-secondary); border-radius: 6px; border-left: 3px solid var(--primary);">
                    <strong style="display: block; margin-bottom: 4px; color: var(--text-primary);">Example Queries:</strong>
                    <ul style="margin: 8px 0 0 0; padding-left: 20px; color: var(--text-secondary); font-size: 14px;">
                        <li>"Show critical patients in Mumbai"</li>
                        <li>"Find kidney donors with O+ blood"</li>
                        <li>"What's my match statistics?"</li>
                        <li>"How many donors are in the network?"</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h3>Data Export</h3>
        </div>
        <div class="card-body">
            <p style="color: var(--text-secondary); margin-bottom: 16px;">
                Export your hospital's data for backup or compliance purposes.
            </p>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <button class="btn btn-outline" onclick="exportData('donors')">
                    <i class="fas fa-download"></i> Export Donors
                </button>
                <button class="btn btn-outline" onclick="exportData('patients')">
                    <i class="fas fa-download"></i> Export Patients
                </button>
                <button class="btn btn-outline" onclick="exportData('matches')">
                    <i class="fas fa-download"></i> Export Matches
                </button>
                <button class="btn btn-outline" onclick="exportData('all')">
                    <i class="fas fa-download"></i> Export All Data
                </button>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h3>Danger Zone</h3>
        </div>
        <div class="card-body">
            <p style="color: var(--text-secondary); margin-bottom: 16px;">
                Irreversible actions. Please proceed with caution.
            </p>
            <button class="btn btn-danger" onclick="clearCache()">
                <i class="fas fa-trash"></i> Clear Application Cache
            </button>
        </div>
    </div>
</div>

<script>
// API keys are now integrated server-side - no user configuration needed

function exportData(type) {
    window.location.href = `/export/${type}`;
}

function clearCache() {
    if (confirm('Clear all cached data? This will reset your preferences.')) {
        localStorage.clear();
        alert('Cache cleared. Page will reload.');
        location.reload();
    }
}

// Theme toggle
document.getElementById('theme-light')?.addEventListener('click', () => {
    document.documentElement.setAttribute('data-theme', 'light');
    localStorage.setItem('theme', 'light');
});

document.getElementById('theme-dark')?.addEventListener('click', () => {
    document.documentElement.setAttribute('data-theme', 'dark');
    localStorage.setItem('theme', 'dark');
});

// Load saved preferences
document.addEventListener('DOMContentLoaded', () => {
    const theme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', theme);
});
</script>
{% endblock %}

