{% extends "base.html" %}

{% block title %}Edit Patient - LifeLink{% endblock %}

{% block content %}
<div class="container" style="max-width: 900px;">
    <div class="page-header">
        <h1>
            <i class="fas fa-edit"></i>
            Edit Patient: {{ patient.patient_id }}
        </h1>
    </div>

    <div class="card">
        <div class="card-body" style="padding: 32px;">
            <form method="POST" data-validate>
                <!-- Basic Information -->
                <h3 style="color: var(--text-primary); margin-bottom: 20px; font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-id-card" style="color: var(--primary);"></i> Basic Information
                </h3>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-control" name="name" value="{{ patient.name }}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date of Birth *</label>
                        <input type="date" class="form-control" name="dob" value="{{ patient.dob }}" max="{{ today }}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gender *</label>
                        <select class="form-select" name="gender" required>
                            <option value="">Select</option>
                            <option value="Male" {% if patient.gender == 'Male' %}selected{% endif %}>Male</option>
                            <option value="Female" {% if patient.gender == 'Female' %}selected{% endif %}>Female</option>
                            <option value="Other" {% if patient.gender == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Blood Group *</label>
                        <select class="form-select" name="blood_group" required>
                            <option value="">Select</option>
                            {% for bg in ['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'] %}
                            <option value="{{ bg }}" {% if patient.blood_group == bg %}selected{% endif %}>{{ bg }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contact Number *</label>
                        <input type="tel" class="form-control" name="contact" value="{{ patient.contact }}" pattern="[0-9]{10}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Location *</label>
                        <input type="text" class="form-control" name="location" value="{{ patient.location }}" placeholder="City" required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Weight (kg) *</label>
                        <input type="number" class="form-control" name="weight_kg" id="weight_kg" value="{{ patient.weight_kg }}" step="0.1" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Height (cm) *</label>
                        <input type="number" class="form-control" name="height_cm" id="height_cm" value="{{ patient.height_cm }}" step="0.1" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">BMI (auto)</label>
                        <input type="text" class="form-control" id="bmi-display" readonly value="--">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Doctor Assigned *</label>
                    <input type="text" class="form-control" name="doctor_assigned" value="{{ patient.doctor_assigned }}" placeholder="Dr. Name" required>
                </div>

                <!-- Organ & Medical Info -->
                <hr style="margin: 2rem 0; border-color: var(--border-color);">
                <h3 style="color: var(--text-primary); margin-bottom: 20px; font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-heartbeat"></i> Medical Information
                </h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Organ Needed *</label>
                        <select class="form-select" name="organ_needed" id="organ_needed" required>
                            <option value="">Select Organ</option>
                            {% for org in ['Kidney', 'Liver', 'Heart', 'Lung', 'Pancreas'] %}
                            <option value="{{ org }}" {% if patient.organ_needed == org %}selected{% endif %}>{{ org }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Urgency Score (1-100) *</label>
                        <input type="range" class="form-control" name="urgency_score" id="urgency_score" min="1" max="100" value="{{ patient.urgency_score }}" required>
                        <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                            <span id="urgency-value" style="font-weight: 700; font-size: 1.25rem;">{{ patient.urgency_score }}</span>
                            <span id="urgency-label" style="font-weight: 600;">Moderate</span>
                        </div>
                    </div>
                </div>

                <!-- Organ-specific fields (same structure as add_patient.html, with pre-filled values) -->
                <!-- Kidney, Liver, Heart, Pancreas, Lung fields would go here with pre-filled values -->
                <!-- For brevity, including key sections -->

                <!-- Medical History -->
                <div class="form-group">
                    <label class="form-label">Medical History (select all that apply)</label>
                    <div class="checkbox-group">
                        {% for condition in ['Diabetes', 'Hypertension', 'Heart Disease', 'Kidney Disease'] %}
                        <label class="checkbox-item">
                            <input type="checkbox" name="medical_history" value="{{ condition }}" {% if condition in medical_history %}checked{% endif %}> {{ condition }}
                        </label>
                        {% endfor %}
                    </div>
                </div>

                <!-- Submit -->
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary btn-lg" style="flex: 1;">
                        <i class="fas fa-save"></i>
                        Save Changes
                    </button>
                    <a href="{{ url_for('patient_detail', patient_id=patient.patient_id) }}" class="btn btn-outline btn-lg">
                        <i class="fas fa-times"></i>
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

