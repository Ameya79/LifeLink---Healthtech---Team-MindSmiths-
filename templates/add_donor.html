{% extends "base.html" %}

{% block title %}Add Donor - LifeLink{% endblock %}

{% block content %}
<div class="container" style="max-width: 900px;">
    <div class="page-header">
        <h1>
            <i class="fas fa-hand-holding-heart"></i>
            Register New Donor
        </h1>
    </div>

    <div class="card">
        <div class="card-body" style="padding: 32px;">
            <form method="POST" data-validate>
                <!-- Basic Information -->
                <h3 style="color: var(--text-primary); margin-bottom: 20px; font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-id-card" style="color: var(--primary); font-size: 16px;"></i> Basic Information
                </h3>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date of Birth *</label>
                        <input type="date" class="form-control" name="dob" max="{{ today }}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gender *</label>
                        <select class="form-select" name="gender" required>
                            <option value="">Select</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Blood Group *</label>
                        <select class="form-select" name="blood_group" required>
                            <option value="">Select</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contact Number *</label>
                        <input type="tel" class="form-control" name="contact" pattern="[0-9]{10}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Location *</label>
                        <input type="text" class="form-control" name="location" placeholder="City" required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Weight (kg) *</label>
                        <input type="number" class="form-control" name="weight_kg" id="weight_kg" step="0.1" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Height (cm) *</label>
                        <input type="number" class="form-control" name="height_cm" id="height_cm" step="0.1" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">BMI (auto)</label>
                        <input type="text" class="form-control" id="bmi-display" readonly value="--">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Doctor Assigned *</label>
                    <input type="text" class="form-control" name="doctor_assigned" placeholder="Dr. Name" required>
                </div>

                <!-- Organ & Medical Info -->
                <hr style="margin: 2rem 0; border-color: var(--border-color);">
                <h3 style="color: var(--text-primary); margin-bottom: 20px; font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-heartbeat" style="color: var(--primary); font-size: 16px;"></i> Donor Information
                </h3>

                <div class="form-group">
                    <label class="form-label">Organ Type *</label>
                    <select class="form-select" name="organ_type" id="organ_type" required>
                        <option value="">Select Organ</option>
                        <option value="Kidney">Kidney</option>
                        <option value="Liver">Liver</option>
                        <option value="Heart">Heart</option>
                        <option value="Lung">Lung</option>
                        <option value="Pancreas">Pancreas</option>
                    </select>
                </div>

                <!-- Kidney-Specific Fields -->
                <div id="kidney-fields" class="organ-specific" style="display: none;">
                    <h4 style="color: var(--text-secondary); margin: 1.5rem 0 1rem;">Kidney-Specific Metrics</h4>
                    <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.75rem; margin-bottom: 1rem;">
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-A1</label>
                            <input type="text" class="form-control" name="hla_a1" placeholder="A1">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-A2</label>
                            <input type="text" class="form-control" name="hla_a2" placeholder="A2">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-B1</label>
                            <input type="text" class="form-control" name="hla_b1" placeholder="B7">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-B2</label>
                            <input type="text" class="form-control" name="hla_b2" placeholder="B8">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-DR1</label>
                            <input type="text" class="form-control" name="hla_dr1" placeholder="DR1">
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.875rem;">HLA-DR2</label>
                            <input type="text" class="form-control" name="hla_dr2" placeholder="DR4">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Serum Creatinine (mg/dL)</label>
                            <input type="number" class="form-control" name="serum_creatinine" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Kidney Function (%)</label>
                            <input type="number" class="form-control" name="kidney_function" min="0" max="100">
                        </div>
                    </div>
                </div>

                <!-- Liver-Specific Fields -->
                <div id="liver-fields" class="organ-specific" style="display: none;">
                    <h4 style="color: var(--text-secondary); margin: 1.5rem 0 1rem;">Liver-Specific Metrics</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">ALT (U/L)</label>
                            <input type="number" class="form-control" name="alt">
                        </div>
                        <div class="form-group">
                            <label class="form-label">AST (U/L)</label>
                            <input type="number" class="form-control" name="ast">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Liver Condition</label>
                            <select class="form-select" name="liver_condition">
                                <option value="Normal">Normal</option>
                                <option value="Mild Damage">Mild Damage</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Heart-Specific Fields -->
                <div id="heart-fields" class="organ-specific" style="display: none;">
                    <h4 style="color: var(--text-secondary); margin: 1.5rem 0 1rem;">Heart-Specific Metrics</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Ejection Fraction (%)</label>
                            <input type="number" class="form-control" name="ejection_fraction" min="0" max="100" placeholder=">50%">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Heart Condition</label>
                            <select class="form-select" name="heart_condition">
                                <option value="Excellent">Excellent</option>
                                <option value="Good">Good</option>
                                <option value="Fair">Fair</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Donor Death Date</label>
                        <input type="date" class="form-control" name="death_date" id="death_date">
                        <small style="display: block; margin-top: 6px; color: var(--text-secondary);">Required for heart donations to verify viability window.</small>
                    </div>
                </div>

                <!-- Pancreas-Specific Fields -->
                <div id="pancreas-fields" class="organ-specific" style="display: none;">
                    <h4 style="color: var(--text-secondary); margin: 1.5rem 0 1rem;">Pancreas-Specific Metrics</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Pancreas Function (%)</label>
                            <input type="number" class="form-control" name="pancreas_function" min="0" max="100" placeholder="0-100">
                        </div>
                        <div class="form-group">
                            <label class="form-label">C-peptide Level (ng/mL)</label>
                            <input type="number" class="form-control" name="c_peptide_level" step="0.1" min="0" placeholder=">0.5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Islet Cell Viability (%)</label>
                            <input type="number" class="form-control" name="islet_cell_viability" min="0" max="100" placeholder="0-100">
                        </div>
                    </div>
                </div>

                <!-- Lung-Specific Fields -->
                <div id="lung-fields" class="organ-specific" style="display: none;">
                    <h4 style="color: var(--text-secondary); margin: 1.5rem 0 1rem;">Lung-Specific Metrics</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">FEV1 Score (%)</label>
                            <input type="number" class="form-control" name="fev1_score" min="0" max="100" placeholder="â‰¥70%">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Smoking History</label>
                            <select class="form-select" name="smoking_history">
                                <option value="Never">Never</option>
                                <option value="Former">Former Smoker</option>
                                <option value="Current">Current Smoker</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Chest X-ray Status</label>
                            <select class="form-select" name="chest_xray_status">
                                <option value="Normal">Normal</option>
                                <option value="Clear">Clear</option>
                                <option value="Abnormal">Abnormal - Review Required</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Medical History -->
                <div class="form-group">
                    <label class="form-label">Medical History (select all that apply)</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="medical_history" value="Diabetes"> Diabetes
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="medical_history" value="Hypertension"> Hypertension
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="medical_history" value="Heart Disease"> Heart Disease
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="medical_history" value="Kidney Disease"> Kidney Disease
                        </label>
                    </div>
                </div>

                <!-- Submit -->
                <button type="submit" class="btn btn-success btn-lg btn-block mt-4">
                    <i class="fas fa-check-circle"></i>
                    Register Donor
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}